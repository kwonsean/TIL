# 220117(ì›”)

# ì˜¤ëŠ˜ ê³µë¶€í•œ ê²ƒ

- ë…¸ë§ˆë“œ Redux ê°•ì˜ ([repo](https://github.com/kwonsean/Nomad_Redux))

# ê¸°ì–µí•´ì•¼ í•  ê²ƒ

## Redux in vanila JS

ê°€ì¥ ë¨¼ì € storeë¥¼ ë§Œë“¤ì–´ì•¼ í•˜ë©° ë§Œë“œëŠ” ë°©ë²•ì€ `createStore(reducer)` í˜•íƒœì´ë‹¤.

ì´ë•Œ reducerëŠ” í•¨ìˆ˜ì´ê³  ì´ reducerëŠ” dataë¥¼ ìˆ˜ì •í•˜ëŠ” ì—­í• ì„ í•œë‹¤.

reducerí•¨ìˆ˜ê°€ ë¦¬í„´í•˜ëŠ” ê°’ì´ ë°ì´í„°ê°€ ë˜ê³  ì´ ë°ì´í„°ëŠ” storeì—ì„œ getState()ë¥¼ ì´ìš©í•˜ì—¬ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.

```jsx
const reducer = () => {
  return 'hello'
}

const nextReducer = () => {
  return 'next hi'
}
const store = createStore(reducer)

console.log(store)
// {dispatch: Æ’, subscribe: Æ’, getState: Æ’, replaceReducer: Æ’, @@observable: Æ’}
console.log(store.getState()) // hello

console.log(store.replaceReducer(nextReducer)) // ì§€ì •í•œ reducer í•¨ìˆ˜ë¥¼ ë°”ê¿€ìˆ˜ë„ ìˆë‹¤.
console.log(store.getState()) // next hi
```

ë”°ë¼ì„œ reducerëŠ” stateë¥¼ ì¸ìˆ˜ë¡œ ë°›ê³  ê·¸ ê°’ì„ ìˆ˜ì •í•˜ì—¬ returní•˜ëŠ” í˜•íƒœë¥¼ ê°€ì§„ë‹¤.

```jsx
const reducer = (state = 0) => {
  // state ìˆ˜ì • ì½”ë“œ ~
  return state
}
```

ì´ë•Œ ìˆ˜ì •í•˜ëŠ” ì½”ë“œëŠ” ë‘ë²ˆì§¸ ì¸ìˆ˜ë¡œ actionì„ ì „ë‹¬í•˜ì—¬ ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤.

```jsx
const reducer = (state = 0, action) => {
  console.log(action) // {type: '@@redux/INITm.o.d.c.9.w'}
  return state
}
```

> ë‹¹ì—°íˆ undefinedê°€ ë‚˜ì˜¬ì¤„ ì•Œì•˜ëŠ”ë° ì´ìƒí•œ ê°’ì´ ê¸°ë³¸ì ìœ¼ë¡œ ë“¤ì–´ê°€ ìˆë‹¤...?

reducerì— actionì„ ì „ë‹¬í•˜ëŠ” ë°©ë²•ì€ storeì— dispatchë¥¼ ì´ìš©í•˜ë©´ ëœë‹¤.
ì´ë•Œ actionì˜ í˜•ì‹ì€ ê°ì²´ í˜•ì‹ì´ê³  typeì„ ê°€ì§€ê³  ìˆì–´ì•¼ í•œë‹¤.

```jsx
const reducer = (state = 0, action) => {
  console.log(action)
  return state
}

const store = createStore(reducer)

store.dispatch({ name: 'ksh' })
// ì—ëŸ¬ ë°œìƒ
// Actions may not have an undefined "type" property.
// You may have misspelled an action type string constant.

store.dispatch({ type: 'default', name: 'ksh' })
// {type: 'default', name: 'ksh'}
```

ì´ë ‡ê²Œ ì§€ì •í•œ íƒ€ì…ì„ ê¸°ì¤€ìœ¼ë¡œ dataë¥¼ ìˆ˜ì •í•˜ê²Œ ëœë‹¤.

```jsx
const reducer = (state = 0, action) => {
  console.log(state, action)
  if (action.type === 'ADD') {
    return state + 1
  } else if (action.type === 'MINUS') {
    return state - 1
  } else {
    return state
  }
}

const store = createStore(reducer)

store.dispatch({ type: 'ADD' })
store.dispatch({ type: 'ADD' })
store.dispatch({ type: 'ADD' })
store.dispatch({ type: 'ADD' })
store.dispatch({ type: 'MINUS' })
console.log(store.getState())

/* ì¶œë ¥
0 {type: '@@redux/INITw.0.z.r.m.w'} ë§¨ì²˜ìŒ dispatchì „
0 {type: 'ADD'} ì²˜ìŒ ADD
1 {type: 'ADD'} 
2 {type: 'ADD'} 
3 {type: 'ADD'}
4 {type: 'MINUS'}
3
*/
```

<aside>
ğŸ“Œ ì‹ ê¸°í•œ ì ì€ ë”°ë¡œ stateì— ê°’ì„ ë„£ì–´ì£¼ì§€ ì•ŠëŠ”ë°ë„ ì•Œì•„ì„œ ì—…ë°ì´íŠ¸ëœ ê°’ì´ ë“¤ì–´ê°€ì§„ë‹¤ëŠ” ê²ƒì´ë‹¤. (ì²˜ìŒì—” undefinedë‹ˆ ê¸°ë³¸ê°’ì´ ì„¤ì •ë˜ì—ˆê³  ì´í›„ ë¶€í„°ëŠ” ê³„ì‚°ëœ ê²°ê³¼ê°’ì´ ì•Œì•„ì„œ ì˜ ë“¤ì–´ê°„ë‹¤)
reducerí•¨ìˆ˜ê°€ ë¦¬í„´í•˜ëŠ” ê°’ì€ stateê°’ì´ ë˜ë©° reducerí•¨ìˆ˜ëŠ” (current state, action)ì„ ì´ìš©í•˜ì—¬ ì‹¤í–‰ëœë‹¤. ë”°ë¼ì„œ stateê°’ì´ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸ ë˜ëŠ”ê²ƒ ê°™ë‹¤.

</aside>

ì´ì œ ì´ dispatchë¥¼ ë²„íŠ¼ê³¼ ì—°ê²° í•œ ë’¤ subscribeë¥¼ ì´ìš©í•˜ë©´ ê°’ì´ ë³€í• ë•Œ ë§ˆë‹¤ ì¸ìˆ˜ë¡œ ë„£ì€ í•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìˆë‹¤.

```jsx
import { createStore } from 'redux'

const add = document.getElementById('add')
const minus = document.getElementById('minus')
const number = document.querySelector('span')

number.innerText = 0 // ì´ˆê¸°ê°’

// ë³´í†µ if ëŒ€ì‹  switchë¥¼ ì‚¬ìš©í•œë‹¤.
const reducer = (state = 0, action) => {
  if (action.type === 'ADD') {
    return state + 1
  } else if (action.type === 'MINUS') {
    return state - 1
  } else {
    return state
  }
}

const store = createStore(reducer)

const onChange = () => {
  console.log(store.getState()) // ì´ ì•ˆì—ì„œë„ store.getState()ê°€ ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤.
  number.innerText = store.getState()
}

store.subscribe(onChange) // state ê°’ì´ ë³€í• ë•Œ ë§ˆë‹¤ onChange í•¨ìˆ˜ ì‹¤í–‰

add.addEventListener('click', () => store.dispatch({ type: 'ADD' }))
minus.addEventListener('click', () => store.dispatch({ type: 'MINUS' }))
```

### stateê°’ì„ mutateí•˜ë©´ ì•ˆëœë‹¤

ë§Œì•½ stateê°€ ë°°ì—´ì¼ ê²½ìš° state.push()ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒ ì²˜ëŸ¼ ì„ì˜ë¡œ stateë¥¼ ìˆ˜ì •í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ returnê°’ìœ¼ë¡œ ìˆ˜ì •ëœ stateë¥¼ ë„˜ê²¨ì£¼ì–´ì•¼ í•œë‹¤.
ì¦‰, ì•„ë˜ ì½”ë“œ ì²˜ëŸ¼ returnì„ ìƒˆë¡œìš´ ê°’ìœ¼ë¡œ ë„˜ê²¨ì£¼ì–´ì•¼ì§€ ì„ì˜ë¡œ stateë¥¼ ìˆ˜ì •í•´ì„  ì•ˆëœë‹¤.

```jsx
switch (action.type) {
  case ADD_TODO:
    return [...state, { text: action.text, id: Date.now() }]
  case DELETE_TODO:
    return state.filter((todo) => todo.id !== action.id)
  default:
    return state
}
```

<br/>

## React-Redux

### mapStateToProps

- storeì— ìˆëŠ” stateë¥¼ ì‚¬ìš©í•˜ê³ ì í•˜ëŠ” componentì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

1. storeë¥¼ ìƒì„± í›„ exportí•œë‹¤.

   ```jsx
   import { createStore } from 'redux'
   function reducer(state = [], action) {
     ìƒëµ
   }
   const store = createStore(reducer)

   export default store // export
   ```

2. react-reduxì˜ Providerì— propsë¡œ storeë¥¼ ë„£ì–´ì¤€ë‹¤.

   ```jsx
   import { Provider } from 'react-redux'
   import store from './store'
   ;<Provider store={store}>
     <App />
   </Provider>
   ```

3. ì‚¬ìš©í•  ì»´í¬ë„ŒíŠ¸ì—ì„œ export default ë¶€ë¶„ì— `connect(í•¨ìˆ˜)(í˜„ì¬ì»´í¬ë„ŒíŠ¸)`ë¥¼ ì‘ì„±í•œë‹¤.

   ```jsx
   import React, { useState } from 'react'
   import { connect } from 'react-redux'

   function Home(props) {
     console.log(props)
     const [text, setText] = useState('')

     function onChange(e) {
       ìƒëµ
     }

     function onSubmit(e) {
       ìƒëµ
     }

     return <>ìƒëµ</>
   }
   // stateëŠ” storeì— ìˆëŠ” stateë¥¼, ownPropsëŠ” Homeì´ ë°›ê³  ìˆëŠ” propsë¥¼ ë³´ì—¬ì¤Œ
   function mapStateToProps(state, ownProps) {
     return { toDos: state }
   }

   export default connect(mapStateToProps)(Home) // í•¨ìˆ˜, ì»´í¬ë„ŒíŠ¸ ìˆœìœ¼ë¡œ ë„£ì–´ì¤€ë‹¤.
   ```

4. connectì— ë„£ëŠ” í•¨ìˆ˜ë¥¼ ì‘ì„±í•œë‹¤. ì´ í•¨ìˆ˜ëŠ” stateë¥¼ ì¸ìˆ˜ë¡œ ë°›ìœ¼ë©° returnì‹œ ë¬´ì¡°ê±´ ê°ì²´ í˜•íƒœë¡œ í•´ì•¼í•œë‹¤. ê·¸ë¦¬ê³  ì´ returnê°’ì€ í˜„ì¬ ì»´í¬ë„ŒíŠ¸ì— propsì— ì¶”ê°€ëœë‹¤.

   ```jsx
   // props ì¶œë ¥ ê²°ê³¼
   {toDos: Array(0), dispatch: Æ’}
   ```

### mapDispatchToProps

- store.dispatch()ë¥¼ ì´ì œ íŠ¹ì • ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤.

1. connectì˜ ë‘ë²ˆì§¸ ì¸ìˆ˜ë¡œ dispatchë¥¼ ì¸ìˆ˜ë¡œ ë°›ëŠ” í•¨ìˆ˜ë¥¼ ë„£ì–´ì£¼ê³ , ì„ ì–¸í•´ì¤€ë‹¤.

   ```jsx
   function mapDispatchToProps(dispatch, ownProps) {
     console.log(dispatch)
     return {
       addTodo: (text) => dispatch(actionCreators.addTodo(text)),
     }
   }

   export default connect(mapStateToProps, mapDispatchToProps)(Home)
   ```

   > ì—¬ê¸°ì„œ actionCreatorsëŠ” storeì—ì„œ exportí•˜ëŠ” actioní•¨ìˆ˜ë“¤ì´ë‹¤.
   > ë‹¨ìˆœíˆ ê°ì²´ í˜•íƒœë¡œ typeê³¼ í•„ìš”í•œ text, idë¥¼ ë¦¬í„´í•˜ëŠ” í•¨ìˆ˜ë“¤ì„ ì‚¬ìš©í•˜ê¸° í¸í•˜ê²Œ í•˜ë‚˜ì˜ ê°ì²´ë¡œ ë¬¶ì–´ exportí•œë‹¤.
   >
   > ```jsx
   > const addTodo = (text) => {
   >   return {
   >     type: ADD,
   >     text,
   >   }
   > }
   >
   > const deleteTodo = (id) => {
   >   return {
   >     type: DELETE,
   >     id,
   >   }
   > }
   >
   > export const actionCreators = {
   >   addTodo,
   >   deleteTodo,
   > }
   > ```

2. ë¦¬í„´í•˜ëŠ” addTodoë¥¼ propsì—ì„œ ë°›ì•„ì„œ ì‚¬ìš©í•œë‹¤.

   ```jsx
   function Home({ toDos, addTodo }) {
     const [text, setText] = useState('')
     // ì œì¶œì´ ë˜ë©´ addTodoì•¡ì…˜ì´ textê°’ì„ ê°€ì§€ê³  ì‹¤í–‰ëœë‹¤.
     function onSubmit(e) {
       e.preventDefault()
       setText('')
       addTodo(text)
     }
   }
   ```

> ì¦‰, í•¨ìˆ˜ë“¤ì´ ì—°ê²°ì—°ê²° ë˜ì–´ ìˆë‹¤.
> Home ì»´í¬ë„ŒíŠ¸ì—ì„œ addTodoë¥¼ ì‹¤í–‰í•˜ë©´ textê°’ì„ dispatch(ìŠ¤í† ì–´ì— ìˆëŠ” addTodo)ì— ì „ë‹¬í•˜ê³ , storeì— ì„ ì–¸ëœ addTodoê°€ ì‹¤í–‰ë˜ì–´ ê°ì²´ë¥¼ ë¦¬í„´í•´ì¤€ë‹¤. ê·¸ë ‡ê²Œ ë¦¬í„´ ë°›ì€ ê°ì²´ë¥¼ ë°”íƒ•ìœ¼ë¡œ dispatchê°€ ì‹¤í–‰ë˜ì–´ stateê°€ ìˆ˜ì •ëœë‹¤.

<br/>

## Redux Toolkit

ì„¤ì¹˜ : `npm i @reduxjs/toolkit`

### createAction

- ì•¡ì…˜ì„ ì†ì‰½ê²Œ ë§Œë“œëŠ” í•¨ìˆ˜ `createAction(ë¬¸ìì—´)` ë¡œ ê²°ê³¼ê°’ìœ¼ë¡œ í•¨ìˆ˜ê°€ ë‚˜ì˜¤ê²Œ ë˜ë©° ê·¸ í•¨ìˆ˜ì˜ íƒ€ì…ì€ ë¬¸ìì—´ì´ ëœë‹¤.
  ```jsx
  const addTodo = createACtion('ADD')
  console.log(typeOf addTodo, addTodo.type) // function ADD
  ```
- ë˜í•œ actionì˜ payloadë¥¼ í†µí•˜ì—¬ ì¸ìˆ˜ë¡œ ë°›ëŠ” ê°’ë“¤(text, id)ì„ ë°›ì„ ìˆ˜ ìˆë‹¤.
  ```jsx
  const reducer = (state = [], action) => {
    // ë˜‘ê°™ì´ payloadë¡œ ì‘ì„±í•´ë„ ìƒê´€ì—†ë‹¤.
    // ì¸ìˆ˜ë¡œ ë°›ëŠ” ê°’ì„ payloadë¡œ ë°›ê¸° ë•Œë¬¸ì—
    switch (action.type) {
      case addTodo.type:
        return [...state, { text: action.payload, id: Date.now() }]
      case deleteTodo.type:
        return state.filter((todo) => todo.id !== action.payload)
      default:
        return state
    }
  }
  ```
  > ê·¼ë° ì¸ìˆ˜ë¥¼ 2ê°œ ë„£ìœ¼ë©´ ì–´ë–»ê²Œ ë˜ë‚˜ ì„ì˜ë¡œ ë„£ì–´ë´¤ëŠ”ë° ì²«ë²ˆì§¸ ì¸ìˆ˜ë§Œ payloadë¡œ ì „ë‹¬ë  ë¿ ë‚˜ë¨¸ì§€ ì¸ìˆ˜ëŠ” ë¬´ì‹œë˜ì—ˆë‹¤.
  > ê·¸ë ‡ë‹¤ë©´ ì¸ìˆ˜ê°€ 2ê°œì´ìƒì¸ actionì€ ëª»ì“°ëŠ”ê±´ì§€? ì°¾ì•„ë³¼ ì˜ˆì •ì´ë‹¤.
  > ![createAction](https://s3.us-west-2.amazonaws.com/secure.notion-static.com/f53828d7-c70f-4772-8afd-d0f3c79d3dae/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20220117%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20220117T153557Z&X-Amz-Expires=86400&X-Amz-Signature=aec9cb608eb0cf9ab1fb6c10e20372e86cc843467c41bca0f88183884820c540&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Untitled.png%22&x-id=GetObject)
  > ì•¡ì…˜ë¶€ë¶„ë§Œ ìˆ˜ì •í•´ë„ ì½”ë“œê°€ ë§ì´ ì¤„ì—ˆë‹¤.

### createReducer

- reducerí•¨ìˆ˜ë„ ì§§ê³  ê°„ë‹¨í•˜ê²Œ ì‘ì„±ì´ ê°€ëŠ¥í•˜ë‹¤.
- switchë¬¸ ì—†ì´ actionëª…ìœ¼ë¡œ ì–´ë–¤ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í• ì§€ ì§€ì •ê°€ëŠ¥í•˜ë‹¤
- stateê°’ì„ mutateí•  ìˆ˜ ìˆë‹¤.
- ë‹¨ mutateí•˜ëŠ” ê²½ìš°ì—ëŠ” returnê°’ì´ ì—†ì–´ì•¼ í•˜ë©°, returní•˜ëŠ” ê²½ìš°ì—ëŠ” ìˆ˜ì •í•œ stateë¥¼ returní•´ì•¼ í•œë‹¤.(ì´ì „ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ)
  ```jsx
  const reducer = createReducer([], {
    [addTodo]: (state, action) => {
      state.push({ text: action.payload, id: Date.now() })
    },
    [deleteTodo]: (state, action) => {
      return state.filter((todo) => todo.id !== action.payload)
    },
  })
  ```

![createReducer](https://s3.us-west-2.amazonaws.com/secure.notion-static.com/59fce8bf-108c-4739-b47d-763d4b272d79/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20220117%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20220117T153803Z&X-Amz-Expires=86400&X-Amz-Signature=48e5fa99b1add92ee3660f0cb4d9e40732551e7be097ec56eb23ba7930bed1b7&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Untitled.png%22&x-id=GetObject)

### createSlice

- createSliceë¥¼ ì´ìš©í•˜ë©´ í•œë²ˆì— actionê³¼ reducerë¥¼ ì„ ì–¸í•  ìˆ˜ ìˆë‹¤.
  ë”°ë¼ì„œ ì½”ë“œì˜ ê¸¸ì´ê°€ ì •ë§ ì •ë§ ì¤„ì–´ë“ ë‹¤.
- actionë“¤ì€ toDos.actionsì— ë‹´ê²¨ ìˆìœ¼ë¯€ë¡œ êµ¬ì¡°ë¶„í•´ í• ë‹¹ í›„ exportí•˜ì—¬ ì‚¬ìš©í•œë‹¤.

  ```jsx
  const toDos = createSlice({
    name: 'toDosReducer',
    initialState: [],
    reducers: {
      add: (state, action) => {
        state.push({ text: action.payload, id: Date.now() })
      },
      remove: (state, action) => {
        return state.filter((todo) => todo.id !== action.payload)
      },
    },
  })

  console.log(toDos.actions) // {add: Æ’, remove: Æ’}

  // ì´ë ‡ê²Œ í• ë‹¹í•˜ì—¬ export
  export const { add, remove } = toDos.actions
  ```

  <br/>

# ì •ë¦¬

ë¦¬ë•ìŠ¤ ê°•ì˜ë¥¼ ë§ì´ ë“¤ì—ˆì§€ë§Œ ë§¤ë²ˆ ë„ëŒ€ì²´ ì™œ ì´ë ‡ê²Œ ë§ì€ íŒŒì¼ë¡œ ë‚˜ëˆ ì„œ ê´€ë¦¬ë¥¼ í•˜ê³  ì´ê±´ ë­” ì—­í• ì„ í•˜ëŠ”ì§€ íŒŒì•…ì„ ì˜ ëª»í–ˆê³  ëŠë‚Œë§Œ ì•Œê³  ìˆì—ˆë‹¤. ê·¸ëŸ°ë° ì´ë²ˆ ë…¸ë§ˆë“œ ê°•ì˜ë¥¼ ë³´ë©´ì„œ reduxê°€ reactì—ì„œë§Œ ì‚¬ìš©ë˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì•„ë‹ˆë¼ ì–´ë””ì„œë“  ì‚¬ìš©ì´ ë˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¼ëŠ” ì‚¬ì‹¤ì„ ì•Œê²Œ ë˜ì—ˆê³  ë¿ë§Œì•„ë‹ˆë¼ store, action, reducerì˜ ìš©ë„, ì›ë¦¬ë¥¼ ì˜ ì´í•´í•  ìˆ˜ ìˆì—ˆë‹¤.

ì ì  ê³µë¶€ë¥¼ í•˜ë©´ì„œ ëŠë¼ëŠ” ê±´ ì½”ë“œë¥¼ ì§œëŠ” ê²ƒë„ ì¤‘ìš”í•˜ì§€ë§Œ ì½”ë“œ, íŒŒì¼ë“¤ì„ ì–´ë–»ê²Œ êµ¬ì„±í• ê±´ì§€ ì„¤ê³„ë¥¼ í•˜ëŠ” ê²ƒë„ êµ‰ì¥íˆ ì¤‘ìš”í•œ ë¶€ë¶„ì¸ ê²ƒ ê°™ë‹¤ëŠ” ëŠë‚Œì„ ë°›ëŠ”ë‹¤. ì–¸ì œì¯¤ ë” ê¹”ë”í•˜ê³  ê´€ë¦¬í•˜ê¸° ì¢‹ê²Œ ì½”ë“œ, íŒŒì¼ì„ êµ¬ì„±í•  ìˆ˜ ìˆì„ì§€... ì´ë˜ì„œ ë‹¤ë“¤ clean codeë¥¼ ê¼­ ë´ë¼ëŠ” ê±´ê°€ ì‹¶ë‹¤. ì‹œê°„ ë‚˜ëŠ” ëŒ€ë¡œ ì¡°ê¸ˆì”© ì½ì–´ë´ì•¼ ê² ë‹¤.
